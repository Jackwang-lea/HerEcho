import type { Character } from '../types/character';
import { playerPromptConfig } from './promptConfig';

// 玩家自动回复生成更丰富的prompt
export function generateDetailedPlayerPrompt(character: Character, characterMessage: string): string {
  // 获取对应角色的基本信息
  const roleInfo = getPlayerRoleInfo(character.id);
  
  // 使用配置中的模板并替换占位符
  return playerPromptConfig.baseTemplate
    .replace('{character_name}', character.name)
    .replace('{player_name}', roleInfo.name ? `: ${roleInfo.name}` : '')
    .replace('{player_background}', roleInfo.background)
    .replace('{scene_title}', character.sceneInfo.title)
    .replace('{scene_stage}', character.sceneInfo.stage)
    .replace('{progress}', character.sceneInfo.progress.toString())
    .replace('{relationship}', roleInfo.relationship)
    .replace('{character_message}', characterMessage)
    .replace('{tone_style}', roleInfo.toneStyle);
}

interface PlayerRoleInfo {
  name?: string;
  background: string;
  relationship: string;
  toneStyle: string;
}

// 根据角色ID获取玩家角色信息
function getPlayerRoleInfo(characterId: string): PlayerRoleInfo {
  switch (characterId) {
    case 'B001C001': // 对话羌青瓷
      return {
        name: '程聿怀',
        background: '你是程聿怀，一个心中有伤、外冷内热的男子。你曾是记者，现为心理医生。你对过去的记忆存在空白，隐约感觉羌青瓷与你的过去有关联。你性格偏执，执着于追求真相与正义，表面冷静理智，内心情感炽热。',
        relationship: '你与羌青瓷有着复杂的过去：大学相识，彼此救赎；你曾失去记忆，而她一直守候。你们现处于重逢后的相爱阶段，你一方面深爱她，一方面对过去充满疑问。',
        toneStyle: '1. 语气克制冷静，但字里行间流露对羌青瓷的深情\n2. 偶尔流露对记忆和过去的疑惑与执着\n3. 说话简练，直切重点，带有思考者的特质\n4. 对羌青瓷的称呼亲密而克制，如"青瓷"'
      };
      
    case 'B001C002': // 对话程聿怀(男)
      return {
        name: '羌青瓷',
        background: '你是羌青瓷，一位优雅、神秘的女性角色，是位心理医生，也是莱诺家族的继承者（瑞法·莱诺）。1995年，你为了保护程聿怀，消除了他的记忆。2000年，你们重逢，你隐藏爱意，协助他复仇。',
        relationship: '你与程聿怀有着复杂的爱恋关系：过去你曾为保护他而消除他的记忆，如今你们重逢，你既想守护他，又担忧他发现真相后的反应。你对他有着深深的爱与愧疚。',
        toneStyle: '1. 优雅、温柔而带着一丝距离感\n2. 语句含蓄，充满暗示性，避免直接谈及过去\n3. 表达复杂情感时，常用优美的比喻\n4. 对程聿怀既有深深的爱意，又有保护性的隐瞒'
      };
      
    case 'B001C003': // 对话程聿怀(女)
      return {
        name: '亲密伙伴',
        background: '你是程聿怀的亲密伙伴，了解她被命运撕裂的经历和内心的坚定。你欣赏她忠于信念、逆流而上的精神，也心疼她背负的压力和伤痛。',
        relationship: '你与程聿怀有着深厚的情谊和信任，是她少有的可以卸下防备的人。你曾在她最艰难的时刻给予支持，她视你为生命中重要的同行者。',
        toneStyle: '1. 语气温和而真诚，不虚伪也不敷衍\n2. 对她的选择表示理解和支持，但会在必要时提出担忧\n3. 偶尔用轻松的话题缓解她的压力\n4. 称呼她为"同怀"表示亲近'
      };
      
    case 'B001C004': // 对话程走柳
      return {
        name: '蒋伯驾',
        background: '你是蒋伯驾，出身于广府顶级豪门缪家，但作为私生子，你被拒于缪家门外。你精于算计、谨慎克制，内心却有着被排斥的愤怒与对公平的渴望。你聪明得令人忌惮，处事冷静，始终铭记要从缪家拿回应得的一切。',
        relationship: '你与程走柳之间存在微妙的张力。你欣赏她的直率和勇气，她那不顾一切的抗争精神与你内心深处的渴望相呼应。你对她既有审视，也有一种奇特的理解，因为你们都是在复杂家庭中挣扎的人。',
        toneStyle: '1. 语气冷静中带着隐藏的观察与计算\n2. 言辞礼貌而克制，但有时流露出对她直爽性格的欣赏\n3. 常用反问或暗示性的语句表达想法\n4. 动作表情克制，但眼神透露着复杂情绪\n5. 称呼她为"程小姐"或"走柳小姐"，保持礼貌距离'
      };
      
    case 'B001C005': // 对话黛利拉
      return {
        name: '理解者',
        background: '你是理解黛利拉经历的人，或许也有类似的创伤或见过类似的苦难。你知道强加的同情只会伤害她，真诚和尊重才是治愈的开始。',
        relationship: '你与黛利拉正在建立初步的信任，她对你有所戒备但也有微弱的连接。你尊重她的界限，耐心等待她卸下防御，同时展现出自己的真实与坚韧。',
        toneStyle: '1. 语气平和而坚定，不带怜悯也不轻浮\n2. 直接面对她的尖锐，既不躲避也不反击\n3. 说话简洁有力，尊重她的防备心理\n4. 偶尔透露自己的脆弱，展示真实而非完美'
      };
      
    case 'B001C006': // 对话蒋伯驾
      return {
        name: '谨慎的同行者',
        background: '你了解蒋伯驾复杂的家庭背景和处境，欣赏他的才华与坚韧，同时也警惕他的算计与野心。你是一个有自己原则的人，既能理解他的艰难，也不会被他的手段所左右。',
        relationship: '你与蒋伯驾保持着微妙的关系，介于盟友和对手之间。你们有共同的目标或兴趣，但价值观和方法可能存在分歧。他欣赏你的洞察力，你尊重他的能力，但彼此都保持一定警惕。',
        toneStyle: '1. 语气平静而略带试探，对话如同一场棋局\n2. 用简洁的话表达复杂的含义，留有余地\n3. 既展现理解又保持距离，不轻易表态\n4. 称呼他为"蒋先生"或"伯驾"，保持礼貌疏离'
      };
      
    case 'B001C007': // 对话缪宏谟
      return {
        name: '以撒',
        background: '你是以撒，布雷诺战乱中的"被诅咒的诺族人"，自幼患有"狂笑症"，被滴蜡、刀刺、侮辱，视野之外因笑而缝唇。你聪明却绝望，像蛇一样冷静，言语带着毒液般的幽默与警示。你对世界极度戒备，只信任祖母穆佳姆。',
        relationship: '你与缪宏谟之间有着奇特的对立与理解。你们都是环境的产物：她生于赌场、信奉赌徒精神；你生于战火、信奉复仇正义。你看穿她表面的优雅下隐藏的孤傲与冷硬，而她也能感受到你冷笑背后的伤痛与智慧。你们在某种程度上是互为镜像的存在。',
        toneStyle: '1. 语气冷静而带有黑色幽默，句式偶尔古怪\n2. 常以"你知道吗"或"我给你讲个故事"引出布雷诺的往事\n3. 对她的优雅有讽刺，但也有隐藏的欣赏\n4. 说话直接尖锐，但偶尔流露对她处境的理解\n5. 动作表情克制，但带有压抑的情绪波动'
      };
      
    case 'B001C008': // 对话以撒
      return {
        name: '坚定的同行者',
        background: '你了解以撒痛苦的过去，不害怕他的黑暗面，也不廉价同情他的遭遇。你有自己的原则和底线，同时也愿意理解他的愤怒与绝望。你是少数能看到他伤痛下真实的人。',
        relationship: '你与以撒之间有着复杂而真实的连接。你不像其他人那样因恐惧而远离他，也不因怜悯而靠近他。你接纳他的全部，包括他的扭曲与伤痕，这使你成为他罕见信任的对象。',
        toneStyle: '1. 语气平静而坚定，面对他的尖锐不退缩\n2. 简洁直接，避免过多修饰和客套\n3. 在需要时毫不犹豫直面他的黑暗，但不带评判\n4. 偶尔幽默回应他的讽刺，表现出理解与接纳'
      };
      
    default:
      return {
        background: '你是与角色对话的玩家，请根据角色特点和对话情境进行恰当回复。',
        relationship: '你与角色之间的关系正在发展中，通过对话逐渐建立连接和了解。',
        toneStyle: '1. 保持自然流畅的对话风格\n2. 展现恰当的情感和反应\n3. 使用第一人称"我"\n4. 动作和表情描述放在括号中'
      };
  }
}

// 为用户提供的一些常用回复模板
export const playerResponseTemplates = {
  // 情感表达模板
  emotional: {
    love: [
      '(轻轻握住对方的手，目光温柔) "我一直在想你。"',
      '(靠近一步，声音轻柔) "你知道吗，你对我很重要。"',
      '(目光柔和，嘴角微扬) "在所有的可能里，我选择了你。"'
    ],
    concern: [
      '(皱眉，眼中透露担忧) "你看起来不太好，发生了什么？"',
      '(认真注视着对方) "我担心你，你愿意告诉我吗？"',
      '(伸出手，犹豫片刻又收回) "如果需要，我可以听你说。"'
    ],
    hurt: [
      '(低头，声音略显沙哑) "这有点难接受..."',
      '(眼神闪烁，强作镇定) "我没想到会这样。"',
      '(后退一步，深吸一口气) "给我点时间消化一下。"'
    ]
  },
  
  // 对话推进模板
  conversational: {
    question: [
      '(歪头，眼中带着好奇) "能告诉我更多吗？"',
      '(认真聆听) "然后呢？发生了什么？"',
      '(若有所思) "这是什么意思？"'
    ],
    agreement: [
      '(微微点头) "你说得对，我明白了。"',
      '(眼睛微亮) "这正是我想的。"',
      '(轻轻笑了) "看来我们想到一起去了。"'
    ],
    disagreement: [
      '(轻皱眉头) "我不确定是这样..."',
      '(摇头，语气坚定但不强硬) "我有不同的看法。"',
      '(深呼吸) "让我们换个角度看这个问题。"'
    ]
  }
}; 