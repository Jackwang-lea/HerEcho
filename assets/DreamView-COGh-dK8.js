import{h as F,d as N,i as R,r as q,j as z,u as V,c,a as e,b as _,e as J,k as n,F as b,f as D,t as a,g as A,o as r,_ as H}from"./index-DnvA3loQ.js";import{B as L}from"./BottomNav-D8KieoPs.js";import{o as f}from"./one-CT9-iJZ3.js";const j=F("dream",{state:()=>({currentStoryId:"",currentSceneId:"",scenes:[],showOptionDialog:!1,currentOption:null,unlockedEffects:[],unlockedStorylines:[],collectedClues:[],memoryFlashbackCount:0,harmToJiangCount:0,endings:[],activeEnding:null,userChoices:[]}),getters:{currentScene(){return this.scenes.find(s=>s.id===this.currentSceneId)},hasUnlockedHiddenEnding(){return this.harmToJiangCount>=3||this.memoryFlashbackCount>=2||this.hasCollectedAllDeathClues},hasCollectedAllDeathClues(){return["撒该之死","劳伦之死","母亲之死"].every(o=>this.collectedClues.includes(o))}},actions:{initializeStory(s){console.log("初始化故事:",s),this.currentStoryId=s,this.showOptionDialog=!1,this.currentOption=null,this.unlockedEffects=[],this.unlockedStorylines=[],this.collectedClues=[],this.memoryFlashbackCount=0,this.harmToJiangCount=0,this.activeEnding=null,this.userChoices=[],this.initializeScenes(),this.currentSceneId="scene1"},initializeScenes(){this.scenes=[{id:"scene1",title:"订婚宴暗流",description:"在这场表面平静的订婚宴上，暗流涌动...",image:f,canReplay:!0,options:[{id:"scene1_opt1",text:"追击蒋伯驾",content:"你决定跟踪蒋伯驾，来到了天台...",nextSceneId:"scene2",consequences:{unlockStoryline:"双面谍影",unlockClue:"缪家密谋"}},{id:"scene1_opt2",text:"维持假面",content:"你选择继续维持表面的平静...",consequences:{triggerEnding:"金丝雀挽歌"}},{id:"scene1_opt3",text:"收集情报",content:"你仔细聆听着周围的谈话...",nextSceneId:"scene2",consequences:{unlockClue:"圣女计划"}},{id:"scene1_opt4",text:"联系程聿怀",content:"你冒险联系了程聿怀...",nextSceneId:"scene2",consequences:{triggerEvent:"血亲保护机制"}}]},{id:"scene2",title:"浴室囚牢",description:"在这个密闭的空间里，真相与谎言交织...",image:f,canReplay:!0,options:[{id:"scene2_opt1",text:"撕裂衬衫",content:"你猛地撕开他的衬衫...",nextSceneId:"scene3",consequences:{unlockClue:"缪家毒蛇纹身"}},{id:"scene2_opt2",text:"呼救未遂",content:"你试图呼救，但情况变得更糟...",consequences:{triggerEnding:"流放结局"}},{id:"scene2_opt3",text:"触碰伤痕",content:"你轻轻触碰那道伤痕...",nextSceneId:"scene3",consequences:{triggerEvent:"记忆闪回"}},{id:"scene2_opt4",text:"支票羞辱",content:"你掏出支票，试图羞辱他...",consequences:{triggerEnding:"灰烬情书"}}]},{id:"scene3",title:"暴雨救援",description:"暴雨中的真相往往伴随着鲜血...",image:f,canReplay:!0,options:[{id:"scene3_opt1",text:"孤身迎战",content:"你选择独自面对危险...",nextSceneId:"scene4",consequences:{unlockStoryline:"独手战鹰"}},{id:"scene3_opt2",text:"身份质询",content:"你决定质问他的真实身份...",nextSceneId:"scene4",consequences:{triggerEvent:"身份揭露"}},{id:"scene3_opt3",text:"拍摄特写",content:"你抓拍下关键证据...",nextSceneId:"scene4",consequences:{triggerEvent:"媒体战"}},{id:"scene3_opt4",text:"依赖体温",content:"在高烧中，你无意识地说出了真相...",nextSceneId:"scene4",consequences:{unlockClue:"父亲死亡真相"}}]},{id:"scene4",title:"真相赌局",description:"最后的对决，一切将在此揭晓...",image:f,canReplay:!0,options:[{id:"scene4_opt1",text:"玉石俱焚",content:"你选择与他同归于尽...",consequences:{triggerEnding:"涅槃结局"}},{id:"scene4_opt2",text:"情绪崩溃",content:"你的精神终于崩溃...",consequences:{triggerEnding:"傀儡结局"}},{id:"scene4_opt3",text:"制造混乱",content:"你果断引爆了天花板...",consequences:{triggerEnding:"审判结局"}},{id:"scene4_opt4",text:"血色拥吻",content:"你用最后的方式传递了真相...",consequences:{triggerEnding:"黎明结局"}}]}],this.endings=[{id:"golden_cage",title:"金丝雀挽歌",description:"你成为了莱诺家族的宣传工具...",type:"BE"},{id:"ashes_letter",title:"灰烬情书",description:"在火光中，你们的故事化为灰烬...",type:"BE"},{id:"nirvana",title:"涅槃重生",description:"在废墟中开出了并蒂孤挺花...",type:"TE"},{id:"dawn",title:"黎明曙光",description:"三年后，你终于站上了胜利的领奖台...",type:"HE"},{id:"dark_transformation",title:"黑化",description:"你继承了伯纳德的衣钵，成为新的暗影...",type:"HE"}]},selectOption(s){var p;const o=this.currentScene;if(!o)return!1;const h=(p=o.options)==null?void 0:p.find(d=>d.id===s);if(!h)return!1;if(this.userChoices.push({sceneId:this.currentSceneId,optionId:s}),this.currentOption=h,this.showOptionDialog=!0,h.consequences){const{unlockStoryline:d,triggerEnding:t,unlockClue:u,triggerEvent:g}=h.consequences;d&&!this.unlockedStorylines.includes(d)&&this.unlockedStorylines.push(d),u&&!this.collectedClues.includes(u)&&this.collectedClues.push(u),g==="记忆闪回"&&this.memoryFlashbackCount++,this.harmToJiangCount>=3?this.activeEnding="dark_transformation":t&&(this.activeEnding=t)}return!0},continueToNextScene(){var s;return(s=this.currentOption)!=null&&s.nextSceneId?(this.currentSceneId=this.currentOption.nextSceneId,this.showOptionDialog=!1,this.currentOption=null,!0):(this.showOptionDialog=!1,this.currentOption=null,!1)},checkSpecialEndings(){this.hasCollectedAllDeathClues&&this.unlockedStorylines.push("真相子弹"),this.memoryFlashbackCount>=2&&this.unlockedStorylines.push("时溯系统")},replayCurrentScene(){this.userChoices.filter(o=>o.sceneId===this.currentSceneId).length>0&&(this.userChoices=this.userChoices.filter(o=>o.sceneId!==this.currentSceneId)),this.showOptionDialog=!1,this.currentOption=null}}}),M={class:"dream-container"},P={class:"background-image"},U=["src"],$={key:0,class:"effects-list"},G={class:"effects-content"},K={key:0,class:"no-effects"},Q={class:"dream-header"},W={class:"dream-title"},X={class:"dream-description"},Y={class:"options-list"},Z=["onClick"],ee={class:"option-text"},te={key:1,class:"option-dialog-overlay"},ne={class:"option-dialog"},se={class:"dialog-content"},ie={key:0,class:"special-effect"},oe={class:"effect-content"},ce={key:2,class:"ending-dialog-overlay"},re={class:"ending-dialog"},le=N({__name:"DreamView",props:{storyId:{}},setup(s){const o=s,h=R(),p=V(),d=o.storyId||h.params.storyId,t=j(),u=q(!1),g=q(!1);function w(v){t.selectOption(v)}function T(){u.value=!0,setTimeout(()=>{t.continueToNextScene(),u.value=!1,t.activeEnding&&setTimeout(()=>{p.push("/dream")},3e3)},500)}function m(){g.value=!g.value}function B(){p.push("/dream")}return z(()=>{if(!d){p.push("/dream");return}t.initializeStory(d)}),(v,i)=>{var k,S,y,C,E,x,I;return r(),c("div",M,[e("div",{class:"back-button",onClick:B},i[0]||(i[0]=[e("span",{class:"back-icon"},"←",-1)])),e("div",P,[e("img",{src:n(f),alt:"背景图片"},null,8,U)]),e("div",{class:"effects-button",onClick:m},i[1]||(i[1]=[e("span",{class:"effects-icon"},"✨",-1)])),g.value?(r(),c("div",$,[e("div",{class:"effects-header"},[i[2]||(i[2]=e("h3",null,"已解锁特殊效果",-1)),e("span",{class:"close-button",onClick:m},"×")]),e("div",G,[n(t).unlockedEffects.length===0?(r(),c("div",K," 尚未解锁任何特殊效果 ")):(r(!0),c(b,{key:1},D(n(t).unlockedEffects,(l,O)=>(r(),c("div",{class:"effect-item",key:O},a(l),1))),128))])])):_("",!0),e("div",{class:A(["content-container",{playing:u.value}])},[e("div",Q,[e("h2",W,a(((k=n(t).currentScene)==null?void 0:k.title)||"加载中..."),1),e("p",X,a(((S=n(t).currentScene)==null?void 0:S.description)||"请稍候..."),1)]),i[3]||(i[3]=e("div",{class:"replay-button-container"},[e("button",{class:"replay-button"},"再次观看")],-1)),e("div",Y,[(r(!0),c(b,null,D(((y=n(t).currentScene)==null?void 0:y.options)||[],l=>(r(),c("div",{key:l.id,class:"option-item",onClick:O=>w(l.id)},[e("div",ee,a(l.text),1)],8,Z))),128))])],2),n(t).showOptionDialog?(r(),c("div",te,[e("div",ne,[e("div",se,[e("p",null,a(((C=n(t).currentOption)==null?void 0:C.content)||"内容加载中..."),1),(E=n(t).currentOption)!=null&&E.specialEffect?(r(),c("div",ie,[i[4]||(i[4]=e("p",{class:"effect-title"},"特殊效果：",-1)),e("p",oe,a(n(t).currentOption.specialEffect),1)])):_("",!0)]),e("div",{class:"dialog-footer"},[e("button",{class:"continue-button",onClick:T},"继续")])])])):_("",!0),n(t).activeEnding?(r(),c("div",ce,[e("div",re,[e("h2",null,"结局："+a((x=n(t).endings.find(l=>l.id===n(t).activeEnding))==null?void 0:x.title),1),e("p",null,a((I=n(t).endings.find(l=>l.id===n(t).activeEnding))==null?void 0:I.description),1),i[5]||(i[5]=e("div",{class:"ending-footer"},[e("p",null,"3秒后返回首页...")],-1))])])):_("",!0),J(L)])}}}),he=H(le,[["__scopeId","data-v-584902aa"]]);export{he as default};
